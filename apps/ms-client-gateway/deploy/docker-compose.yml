services:
  # Servicio para el Client Gateway
  ms-client-gateway:
    profiles: ["client-gateway"]
    build:
      context: ${CONTEXTO}
      dockerfile: ./apps/${MICROSERVICIO}/deploy/Dockerfile
      args:
        - CONTEXT=${CONTEXTO}
        - MICROSERVICIO=${MICROSERVICIO}
    container_name: backend-mc-client-gateway
    ports:
      - "${PORT}:3000"
    env_file:
      - .env
    environment:
      # Configurar el entorno de Node.js
      NODE_ENV: production
      
      # ðŸ‘‡ ESTAS SON LAS VARIABLES QUE TE FALTABAN:
      # Apuntan al nombre del contenedor de usuarios (backend-mc-users)
      MS_USERS_HOST: backend-mc-users
      MS_USERS_PORT: 3001

      # Productos (Puerto 3002) - ðŸ‘ˆ ESTO ES LO QUE FALTABA
      MS_PRODUCTS_HOST: backend-mc-products
      MS_PRODUCTS_PORT: 3002

    networks:
      - backend-mc-pnpm-network

networks:
  backend-mc-pnpm-network:
    external: true
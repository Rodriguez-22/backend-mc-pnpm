{{- if .Values.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tito-ms-gateway-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: tito-ms-gateway
  template:
    metadata:
      labels:
        app: tito-ms-gateway
    spec:
      containers:
        - name: tito-ms-gateway
          image: "jose196/tito-gateway:v1.2"
          resources:
            requests:
              memory: "512Mi"
              cpu: "250m"
            limits:
              memory: "1Gi"
              cpu: "1000m"
          env:
            - name: MICROSERVICIO
              value: "ms-client-gateway"
            - name: REPO_GIT
              value: "git@github.com:Rodriguez-22/backend-mc-pnpm.git"
            # --- CONEXIÃ“N A NATS ---
            - name: NATS_SERVERS
              value: "nats://nats.nats-system.svc.cluster.local:4222"
            # -----------------------
            - name: PORT
              value: {{ .Values.app.containerPort | quote }}
          ports:
            - containerPort: {{ .Values.app.containerPort }}
          envFrom:
            - configMapRef:
                name: tito-ms-gateway-config
          volumeMounts:
            - name: ssh-key-volume
              mountPath: "/mnt/ssh-keys"
              readOnly: true
      volumes:
        - name: ssh-key-volume
          secret:
            secretName: tito-ssh-key
{{- end }}